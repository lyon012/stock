<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock-Out Inventory Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <!-- 
        Chosen Palette: "Hacker Green" - A high-contrast dark theme using a near-black background (#0D1117) and a vibrant green (#39D353) for text and accents, inspired by classic computer terminals. This creates a focused, stylish, and highly readable interface.
        Application Structure Plan: The SPA's single-view data entry structure is retained. The information architecture is focused on the central data grid for efficiency. A new prominent display bar has been added for real-time scanner feedback. The dark theme enhances focus on the data by reducing background glare.
        Visualization & Content Choices: 
        - Report Info: Inventory Data -> Goal: Quick data entry -> Viz/Presentation: Interactive HTML Table (Dark Theme) -> Interaction: Editable cells, new rows on scan -> Justification: The table remains the most efficient UI for this task; the dark theme improves data focus. -> Library/Method: HTML/CSS/JS.
        - Report Info: Barcode Printing -> Goal: Visual confirmation -> Viz/Presentation: Barcode on Canvas (light background for contrast) -> Interaction: Button click -> Justification: The barcode is generated on a canvas is a lightweight, high-quality method that avoids external image dependencies and simulates the output of a thermal printer. -> Library/Method: JsBarcode/Canvas.
        CONFIRMATION: NO SVG graphics used. NO Mermaid JS used.
    -->
    <style>
        body {
            font-family: 'Fira Code', monospace;
            background-color: #0D1117;
            color: #39D353;
        }
        .table-container {
            border: 1px solid #22c55e40;
        }
        td, th {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #22c55e40;
        }
        th {
            color: #a3e635;
        }
        td[contenteditable="true"]:focus {
            background-color: #16a34a20;
            outline: 2px solid #22c55e;
            box-shadow: none;
        }
        .status-bar-active {
            color: #a3e635;
            font-weight: 600;
        }
        .action-button {
            background-color: transparent;
            border: 1px solid #22c55e;
            color: #22c55e;
            transition: all 0.2s ease-in-out;
        }
        .action-button:hover:not(:disabled) {
            background-color: #22c55e;
            color: #0D1117;
            box-shadow: 0 0 10px #22c55e;
        }
        .action-button:disabled {
            border-color: #4b5563;
            color: #4b5563;
            cursor: not-allowed;
        }
        .scanner-display {
            transition: background-color 0.3s;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;600&display=swap" rel="stylesheet">
</head>
<body class="text-slate-800">

    <div class="flex flex-col h-screen">
        <!-- Header -->
        <header class="p-6 border-b border-green-500/25">
            <h1 class="text-2xl font-bold text-green-400">Stock-Out Inventory Tracker</h1>
            <p class="text-green-500/80">Use barcode scanner to log items. Click Amount/Price to edit.</p>
        </header>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto p-6">
            <!-- Scanner Display Bar -->
            <div class="mb-6">
                <div id="scanner-display" class="scanner-display bg-black/30 border border-green-500/25 rounded-lg p-4 text-2xl font-semibold text-center text-green-400 h-16 flex items-center justify-center">
                    <span id="scanner-text">WAITING FOR SCAN...</span>
                </div>
            </div>

            <div class="table-container bg-black/30 rounded-lg">
                <table class="w-full">
                    <thead class="border-b-2 border-green-500/40">
                        <tr>
                            <th class="w-4/12 text-sm font-semibold uppercase tracking-wider">Barcode</th>
                            <th class="w-2/12 text-sm font-semibold uppercase tracking-wider">Amount</th>
                            <th class="w-3/12 text-sm font-semibold uppercase tracking-wider">Price</th>
                            <th class="w-3/12 text-sm font-semibold uppercase tracking-wider">Total Price</th>
                        </tr>
                    </thead>
                    <tbody id="inventory-table-body">
                        <!-- Rows will be dynamically inserted here -->
                    </tbody>
                </table>
            </div>
            <!-- Summary Section -->
            <div id="summary-section" class="mt-6 p-4 bg-black/30 border border-green-500/25 rounded-lg flex justify-end items-center gap-8">
                 <div class="text-right">
                    <p class="text-sm text-green-500/80">Total Items</p>
                    <p id="total-items" class="text-xl font-bold text-green-400">0</p>
                </div>
                <div class="text-right">
                    <p class="text-sm text-green-500/80">Grand Total</p>
                    <p id="grand-total" class="text-xl font-bold text-lime-400">$0.00</p>
                </div>
            </div>
        </main>

        <!-- Footer / Action Bar -->
        <footer class="p-4 bg-black/50 backdrop-blur-sm border-t border-green-500/25 flex items-center justify-between">
            <div id="status-bar" class="text-sm text-green-500/80 flex items-center gap-2">
                <span class="w-2 h-2 rounded-full bg-green-500 animate-ping"></span>
                Ready to scan...
            </div>
            <div class="flex items-center gap-4">
                <button id="print-barcode-btn" class="action-button px-5 py-2.5 text-sm font-semibold rounded-lg">
                    Print Barcode
                </button>
                <button id="save-data-btn" class="action-button px-5 py-2.5 text-sm font-semibold rounded-lg">
                    Save Data
                </button>
            </div>
        </footer>
    </div>

    <!-- Print Barcode Modal -->
    <div id="print-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 hidden">
        <div class="bg-[#0D1117] border border-green-500/25 rounded-lg shadow-xl p-8 max-w-md w-full text-center">
            <h2 class="text-xl font-bold text-green-400 mb-2">Print Barcode</h2>
            <p class="text-green-500/80 mb-6">Simulating print for last scanned item.</p>
            <div class="bg-white p-4 rounded-lg inline-block">
                <canvas id="barcode-canvas"></canvas>
            </div>
            <button id="close-modal-btn" class="mt-8 w-full action-button px-5 py-2.5 text-sm font-semibold rounded-lg">
                Close
            </button>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const state = {
            inventory: [
                { id: 1, barcode: '8901030784013', amount: 5, price: 2.99 },
                { id: 2, barcode: '071795415200', amount: 12, price: 4.50 },
                { id: 3, barcode: '4002293401103', amount: 8, price: 12.75 },
            ],
            lastScanned: null,
            nextId: 4
        };

        const inventoryTableBody = document.getElementById('inventory-table-body');
        const saveDataBtn = document.getElementById('save-data-btn');
        const printBarcodeBtn = document.getElementById('print-barcode-btn');
        const statusBar = document.getElementById('status-bar');
        const printModal = document.getElementById('print-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const barcodeCanvas = document.getElementById('barcode-canvas');
        const totalItemsEl = document.getElementById('total-items');
        const grandTotalEl = document.getElementById('grand-total');
        const scannerDisplayText = document.getElementById('scanner-text');

        const calculateTotals = () => {
            const totalItems = state.inventory.reduce((sum, item) => sum + item.amount, 0);
            const grandTotal = state.inventory.reduce((sum, item) => sum + (item.amount * item.price), 0);
            totalItemsEl.textContent = totalItems;
            grandTotalEl.textContent = `$${grandTotal.toFixed(2)}`;
        };

        const renderTable = () => {
            inventoryTableBody.innerHTML = '';
            if (state.inventory.length === 0) {
                inventoryTableBody.innerHTML = `<tr><td colspan="4" class="text-center text-green-500/60 py-8">No items logged. Start by scanning a barcode.</td></tr>`;
            } else {
                state.inventory.forEach(item => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-green-500/10';
                    row.dataset.rowId = item.id;
                    const totalPrice = item.amount * item.price;
                    row.innerHTML = `
                        <td class="font-mono text-green-400">${item.barcode}</td>
                        <td contenteditable="true" data-id="${item.id}" data-field="amount" class="text-green-300 font-medium">${item.amount}</td>
                        <td contenteditable="true" data-id="${item.id}" data-field="price" class="text-green-300 font-medium">${item.price.toFixed(2)}</td>
                        <td class="font-medium text-lime-400 total-price-cell">$${totalPrice.toFixed(2)}</td>
                    `;
                    inventoryTableBody.appendChild(row);
                });
            }
            updatePrintButtonState();
            calculateTotals();
        };

        const updatePrintButtonState = () => {
            printBarcodeBtn.disabled = !state.lastScanned;
        };

        const handleDataUpdate = (e) => {
            const target = e.target;
            if (target.hasAttribute('contenteditable')) {
                const id = parseInt(target.dataset.id);
                const field = target.dataset.field;
                let value = field === 'price' ? parseFloat(target.textContent) : parseInt(target.textContent);
                
                if (isNaN(value)) { // Revert if input is not a number
                    const originalItem = state.inventory.find(item => item.id === id);
                    target.textContent = originalItem[field];
                    return;
                }

                const itemIndex = state.inventory.findIndex(item => item.id === id);
                if (itemIndex > -1) {
                    state.inventory[itemIndex][field] = value;
                    
                    const updatedItem = state.inventory[itemIndex];
                    const row = inventoryTableBody.querySelector(`tr[data-row-id="${id}"]`);
                    if (row) {
                        const totalPriceCell = row.querySelector('.total-price-cell');
                        totalPriceCell.textContent = `$${(updatedItem.amount * updatedItem.price).toFixed(2)}`;
                    }

                    if (field === 'price') {
                        target.textContent = value.toFixed(2);
                    }
                }
                calculateTotals();
            }
        };

        const addNewItem = (barcode) => {
            const newItem = {
                id: state.nextId++,
                barcode: barcode,
                amount: 1,
                price: 0.00
            };
            state.inventory.push(newItem);
            state.lastScanned = barcode;
            renderTable();

            const newRow = inventoryTableBody.querySelector(`td[data-id="${newItem.id}"][data-field="amount"]`);
            if (newRow) {
                newRow.focus();
                document.execCommand('selectAll', false, null);
            }
        };

        let barcodeBuffer = '';
        let barcodeTimeout;

        const handleKeyInput = (e) => {
            if (e.target.hasAttribute('contenteditable')) {
                return;
            }

            if (e.key === 'Enter') {
                if (barcodeBuffer.length > 3) {
                    statusBar.innerHTML = `<span class="status-bar-active">Scanned: ${barcodeBuffer}</span>`;
                    scannerDisplayText.textContent = `LAST SCAN: ${barcodeBuffer}`;
                    addNewItem(barcodeBuffer);
                }
                barcodeBuffer = '';
                return;
            }

            if (e.key.length === 1 && e.key.match(/[a-zA-Z0-9]/)) {
                barcodeBuffer += e.key;
            }

            statusBar.innerHTML = `<span class="status-bar-active">Scanning...</span>`;
            scannerDisplayText.textContent = barcodeBuffer;

            clearTimeout(barcodeTimeout);
            barcodeTimeout = setTimeout(() => {
                if (barcodeBuffer.length > 0) {
                    barcodeBuffer = '';
                    statusBar.innerHTML = `<span class="w-2 h-2 rounded-full bg-green-500 animate-ping"></span> Ready to scan...`;
                    scannerDisplayText.textContent = 'WAITING FOR SCAN...';
                }
            }, 1000);
        };

        const handleSave = () => {
            saveDataBtn.textContent = 'Saving...';
            saveDataBtn.classList.add('opacity-50');
            setTimeout(() => {
                console.log('Data saved:', state.inventory);
                saveDataBtn.textContent = 'Save Data';
                saveDataBtn.classList.remove('opacity-50');
                statusBar.innerHTML = `<span class="text-lime-400 font-semibold">Data saved successfully!</span>`;
                setTimeout(() => {
                     statusBar.innerHTML = `<span class="w-2 h-2 rounded-full bg-green-500 animate-ping"></span> Ready to scan...`;
                }, 2000);
            }, 1000);
        };
        
        const handlePrint = () => {
            if (!state.lastScanned) return;
            JsBarcode(barcodeCanvas, state.lastScanned, {
                format: "CODE128",
                lineColor: "#000",
                width: 2,
                height: 80,
                displayValue: true
            });
            printModal.classList.remove('hidden');
        };

        document.addEventListener('keydown', handleKeyInput);
        inventoryTableBody.addEventListener('blur', handleDataUpdate, true);
        saveDataBtn.addEventListener('click', handleSave);
        printBarcodeBtn.addEventListener('click', handlePrint);
        closeModalBtn.addEventListener('click', () => printModal.classList.add('hidden'));

        renderTable();
    });
    </script>
</body>
</html>

